#include <vector>
#include <string>
#include <stdexcept>

#include "Bitext.h"

using namespace std;

static vector<vector<mmt::wid_t>> sentences = {
    {1738, 1645, 1738, 2453, 1645, 1738, 1367, 1006, 4082, 8317, 1207, 1020, 4294967295, 4294967294, 1015},
    {4294967295, 1019, 3117},
    {1738, 3022, 1125, 2905, 1314, 1033, 1172, 2150, 1293, 1399, 1020, 2134, 3023, 1015, 1738},
    {4020, 4294967295, 4012},
    {1738, 1937, 1685, 1963, 1645, 2012, 1645, 2021, 1685, 2025, 1685, 1962, 1645, 2014, 1645, 2017, 1645, 1261, 1645, 2019, 1738},
    {1738, 1737, 1738, 2161, 2762, 1015},
    {1738, 9787, 1162, 1738, 10317, 4294967295},
    {1738, 1808, 2063, 1867, 1022, 1221, 1002, 2585, 2012, 1039, 1006, 1172, 2150, 1293, 2134, 1076, 1164, 2586, 1113, 2587, 2038, 1738},
    {1738, 3407, 3408, 1020, 2073, 1019, 1020, 3885, 3886, 7885, 3409, 1738},
    {1583, 7313, 7271, 1367, 7310, 2892, 1054, 6333, 1015, 2337, 1162, 3989, 1022, 1006, 1564, 7314, 1207, 2922, 7308, 1035, 1020, 3968, 1564, 7314, 1367, 7313, 1228, 1642, 1230, 1035, 1020, 1989, 1564, 7314, 1367, 7313, 1228, 1642, 1230, 1035, 1002, 3072, 1076, 1015},
    {2982, 3986, 3427, 1019, 3146, 2209, 1035, 1020, 3846, 1631, 2161, 1020, 1631, 1019, 1020, 1564, 1015},
    {2982, 1006, 7708, 1049, 1632, 1394, 1049, 7763, 7764, 7765, 1035, 1596, 1019, 1020, 7346, 1039, 1020, 1564, 1910, 1649, 3009, 1022, 1020, 3090, 1076, 1436, 1023, 4516, 1367, 1075, 1015},
    {2982, 2252, 1850, 1035, 1006, 7394, 7225, 1049, 1632, 1020, 7514, 1532, 1635, 1022, 4214, 7480, 1653, 7518, 1006, 7519, 1393, 3488, 1020, 1058, 2075, 1006, 7519, 1393, 1015},
    {7456, 1162, 1648, 3039, 1006, 7386, 1207, 1399, 1020, 8015, 2846, 1035, 1162, 1974, 1653, 1213, 1636, 1310, 3715, 1006, 1082, 1393, 1022, 1636, 1015},
    {7229, 3989, 1022, 1020, 7369, 7271, 1019, 1020, 7383, 2436, 1015},
    {1583, 2487, 3090, 20007, 1020, 1192, 2357, 3450, 7330, 1015},
    {1647, 1974, 1252, 1020, 4252, 1065, 1310, 1164, 7395, 2436, 3470, 1033, 7395, 3446, 1015, 1583, 3863, 1019, 1399, 1020, 4252, 1065, 1367, 1049, 1636, 1187, 1508, 1022, 4140, 1015},
    {1016, 1801, 7320, 8261, 2069, 1406, 1020, 1045, 1911, 1039, 1023, 1564, 1002, 7540, 1020, 2847, 1019, 1020, 7320, 1921, 3013, 1020, 1045, 1015}
};

static constexpr size_t phraselen_max = 20;

int main(int argc, char **argv) {
  if(argc < 4)
    throw runtime_error("usage: bitext-stress en it /bitext/model.");
  string l1 = argv[1], l2 = argv[2];
  string base = argv[3];
  bool dummy;

  sto::Bitext bitext(l1, l2);
  bitext.Open(base);

  while(true) {
    for(size_t isent = 0; isent < sentences.size(); isent++) {
      vector<mmt::wid_t> &sentence = sentences[isent];
      for(size_t iword = 0; iword < sentence.size(); iword++) {
        for(size_t len = 1; iword + len <= sentence.size(); len++) {
          vector<mmt::wid_t> phrase{sentence.begin() + iword, sentence.begin() + iword + len};
          dummy ^= bitext.DebugLookupSrc(phrase);
        }
      }
    }
  }

  return 0;
}